<!DOCTYPE html>
<html lang="es">
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <title>Bienvenido - Manejo del Estr√©s Estudiantil</title>
      <meta name="keywords" content="estr√©s estudiantil, bienestar, salud mental">
      <meta name="description" content="Aplicaci√≥n para el manejo del estr√©s estudiantil">
      <meta name="author" content="">
      <link rel="icon" href="images/fevicon.png" type="image/png" />
      <link rel="stylesheet" href="css/bootstrap.min.css" />
      <link rel="stylesheet" href="style.css" />
      <link rel="stylesheet" href="css/responsive.css" />
      <link rel="stylesheet" href="css/colors.css" />
      <link rel="stylesheet" href="css/bootstrap-select.css" />
      <link rel="stylesheet" href="css/perfect-scrollbar.css" />
      <link rel="stylesheet" href="css/custom.css" />
      <link rel="stylesheet" href="css/custom-colors.css" />
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
      <style>
         :root {
            --primary-color: #2C3E50;
            --secondary-color: #E74C3C;
            --accent-color: #3498DB;
            --text-color: #2C3E50;
            --light-bg: #ECF0F1;
            --areandina-green: #00A859;
            --areandina-orange: #F7941D;
         }

         body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
         }

         .auth-container {
            max-width: 450px;
            margin: 50px auto;
            padding: 40px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
         }

         .auth-brain-image {
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: auto;
            opacity: 0.15;
            transform: translate(25%, -25%);
            z-index: 0;
         }

         .auth-content {
            position: relative;
            z-index: 1;
         }

         .auth-container h2 {
            color: var(--areandina-green);
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 600;
         }

         .auth-logo {
            width: 200px;
            margin-bottom: 30px;
         }

         .auth-form {
            display: flex;
            flex-direction: column;
            gap: 25px;
         }

         .auth-form p {
            color: var(--text-color);
            font-size: 16px;
            line-height: 1.5;
         }

         .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background-color: white;
            color: var(--text-color);
            border: 2px solid var(--areandina-green);
            padding: 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            width: 100%;
            font-weight: 500;
         }

         .google-btn:hover {
            background-color: var(--areandina-green);
            color: white;
            box-shadow: 0 4px 8px rgba(0,168,89,0.2);
         }

         .google-btn:hover img {
            filter: brightness(0) invert(1);
         }

         .google-btn img {
            width: 24px;
            height: 24px;
            transition: all 0.3s ease;
         }

         .error-message {
            color: var(--secondary-color);
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(231, 76, 60, 0.1);
         }

         .success-message {
            color: var(--areandina-green);
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(0, 168, 89, 0.1);
         }

         .auth-footer {
            margin-top: 30px;
            color: #666;
            font-size: 14px;
         }

         #app-content {
            display: none;
         }

         .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
         }

         .user-email {
            color: var(--primary-color);
            font-weight: 500;
         }

         .logout-btn {
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.3s;
         }

         .logout-btn:hover {
            background-color: rgba(231, 76, 60, 0.1);
         }

         .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 15px 0;
         }

         .divider::before,
         .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #ddd;
         }

         .divider span {
            padding: 0 10px;
            color: #666;
            font-size: 14px;
         }

         .notification {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            min-width: 300px;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid var(--areandina-green);
         }

         .notification.error {
            border-left-color: var(--secondary-color);
         }

         .notification i {
            margin-right: 12px;
            font-size: 20px;
         }

         .notification.success i {
            color: var(--areandina-green);
         }

         .notification.error i {
            color: var(--secondary-color);
         }

         .notification-content {
            flex-grow: 1;
         }

         .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-color);
         }

         .notification-message {
            color: #666;
            font-size: 14px;
         }

         @keyframes slideIn {
            from {
               transform: translateX(100%);
               opacity: 0;
            }
            to {
               transform: translateX(0);
               opacity: 1;
            }
         }

         @keyframes fadeOut {
            from {
               transform: translateX(0);
               opacity: 1;
            }
            to {
               transform: translateX(100%);
               opacity: 0;
            }
         }

         .goal-checkbox {
            width: 1.5em;
            height: 1.5em;
            accent-color: var(--areandina-green);
            cursor: pointer;
            margin-right: 0.5em;
         }
         .goal-checkbox + span {
            margin-left: 0.7em;
         }
      </style>
   </head>
   <body class="dashboard dashboard_1">
      <!-- Contenedor de Autenticaci√≥n -->
      <div id="auth-container" class="auth-container">
         <img src="/images/logo/cerebro.png" alt="Cerebro" class="auth-brain-image">
         <div class="auth-content">
            <img src="https://cms.areandina.edu.co/sites/default/files/styles/large/public/2022-06/header_educontinua_virtual_-_opt.png?itok=9ItxRIJZ" alt="Logo Areandina" class="auth-logo">
            <h2>Espacio de Bienestar Acad√©mico</h2>
            <div class="auth-form">
               <p>Inicia sesi√≥n con tu cuenta institucional de Areandina (@areandina.edu.co) para acceder a tu espacio de bienestar</p>
               <button onclick="loginWithGoogle()" class="google-btn">
                  <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo">
                  Continuar con Google
               </button>
               <div id="auth-message" class="error-message"></div>
            </div>
            <div class="auth-footer">
               Fundaci√≥n Universitaria del √Årea Andina
            </div>
         </div>
      </div>

      <!-- Contenido Principal de la Aplicaci√≥n -->
      <div id="app-content">
         <div class="full_container">
            <div class="inner_container">
               <!-- Sidebar -->
               <nav id="sidebar">
                  <div class="sidebar_blog_1">
                     <div class="sidebar-header">
                        <div class="logo_section">
                           <a href="index.html"><img class="logo_icon img-responsive" src="https://cms.areandina.edu.co/sites/default/files/styles/large/public/2022-06/header_educontinua_virtual_-_opt.png?itok=9ItxRIJZ" alt="Logo Areandina" /></a>
                        </div>
                     </div>
                     <div class="sidebar_user_info">
                        <div class="icon_setting"></div>
                        <div class="user_profle_side">
                           <div class="user_img"><img class="img-responsive" id="sidebar-user-photo" src="images/layout_img/user_img.jpg" alt="#" /></div>
                           <div class="user_info">
                              <h6 id="sidebar-username">Estudiante</h6>
                              <p><span class="online_animation"></span> En l√≠nea</p>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="sidebar_blog_2">
                     <h4>Men√∫ Principal</h4>
                     <ul class="list-unstyled components">
                        <li class="active">
                           <a href="app.html"><i class="fa fa-home yellow_color"></i> <span>Inicio</span></a>
                        </li>
                        <li>
                           <a href="profile.html"><i class="fa fa-user blue1_color"></i> <span>Mi Perfil</span></a>
                        </li>
                        <li>
                           <a href="settings.html"><i class="fa fa-cog yellow_color"></i> <span>Configuraci√≥n</span></a>
                        </li>
                        <li>
                           <a href="#" onclick="logout()"><i class="fa fa-sign-out yellow_color"></i> <span>Cerrar Sesi√≥n</span></a>
                        </li>
                     </ul>
                  </div>
               </nav>
               <!-- end sidebar -->
               <!-- right content -->
               <div id="content">
                  <!-- topbar -->
                  <div class="topbar">
                     <nav class="navbar navbar-expand-lg navbar-light">
                        <div class="full">
                           <button type="button" id="sidebarCollapse" class="sidebar_toggle"><i class="fa fa-bars"></i></button>
                           <div class="logo_section">
                              <a href="app.html"><img class="img-responsive" src="https://cms.areandina.edu.co/sites/default/files/styles/large/public/2022-06/header_educontinua_virtual_-_opt.png?itok=9ItxRIJZ" alt="Logo Areandina" /></a>
                           </div>
                           <div class="right_topbar">
                              <div class="icon_info">
                                 <ul>
                                    <li><a href="#"><i class="fa fa-bell-o"></i><span class="badge">2</span></a></li>
                                    <li><a href="#"><i class="fa fa-question-circle"></i></a></li>
                                 </ul>
                              </div>
                           </div>
                        </div>
                     </nav>
                  </div>
                  <!-- end topbar -->
                  <!-- dashboard inner -->
                  <div class="midde_cont">
                     <div class="container-fluid">
                        <div class="row column_title">
                           <div class="col-md-12">
                              <div class="page_title">
                                 <h2>Bienvenido a tu Espacio de Bienestar Acad√©mico</h2>
                              </div>
                           </div>
                        </div>
                        <!-- Secci√≥n de Bienvenida -->
                        <div class="row">
                           <div class="col-md-12">
                              <div class="white_shd full margin_bottom_30">
                                 <div class="full graph_head">
                                    <div class="heading1 margin_0">
                                       <h2>¬°Hola! Estamos aqu√≠ para acompa√±arte en tu bienestar</h2>
                                    </div>
                                 </div>
                                 <div class="full padding_infor_info">
                                    <div class="row">
                                       <div class="col-lg-12">
                                          <p class="lead">Bienvenido a tu espacio personal para el manejo del estr√©s acad√©mico. Aqu√≠ encontrar√°s t√©cnicas de respiraci√≥n, mindfulness, organizaci√≥n del tiempo y otras estrategias efectivas para mantener un equilibrio saludable entre tus estudios y tu bienestar. Aprender√°s a identificar tus emociones y recibir√°s recomendaciones personalizadas para cada situaci√≥n.</p>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <!-- Opin√≥metro -->
                        <div class="row">
                           <div class="col-md-6">
                              <div class="white_shd full margin_bottom_30">
                                 <div class="full graph_head">
                                    <div class="heading1 margin_0">
                                       <h2>Recomendaciones para tu estado de √°nimo</h2>
                                    </div>
                                 </div>
                                 <div class="full padding_infor_info">
                                    <div class="row">
                                       <div class="col-lg-12">
                                          <div id="mood-feedback" class="text-center">
                                             <!-- El contenido se llenar√° din√°micamente -->
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-6">
                              <div class="white_shd full margin_bottom_30">
                                 <div class="full graph_head">
                                    <div class="heading1 margin_0">
                                       <h2>¬øC√≥mo te sientes hoy?</h2>
                                    </div>
                                 </div>
                                 <div class="full padding_infor_info">
                                    <div class="row">
                                       <div class="col-lg-12">
                                          <div class="form-group">
                                             <select class="form-control" id="mood-selector">
                                                <option value="">Selecciona tu estado de √°nimo</option>
                                                <option value="frustrado">üò§ Frustrado(a)</option>
                                                <option value="feliz">üòä Feliz</option>
                                                <option value="triste">üò¢ Triste</option>
                                                <option value="ansioso">üò∞ Ansioso(a)</option>
                                             </select>
                                          </div>
                                          <!-- Historial de estados de √°nimo -->
                                          <div class="mt-3">
                                             <h5>√öltimos estados de √°nimo:</h5>
                                             <ul class="list-group" id="mood-history">
                                                <!-- El historial se llenar√° din√°micamente -->
                                             </ul>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <!-- Mis Metas (Movida a nueva fila) -->
                        <div class="row">
                           <div class="col-md-12">
                              <div class="white_shd full margin_bottom_30">
                                 <div class="full graph_head">
                                    <div class="heading1 margin_0">
                                       <h2>Mi Pr√≥xima Meta</h2>
                                    </div>
                                 </div>
                                 <div class="full padding_infor_info">
                                    <div class="row">
                                       <div class="col-lg-12">
                                          <div class="form-group">
                                             <input type="text" class="form-control mb-2" id="goal-input" placeholder="¬øCu√°l es tu pr√≥xima meta?">
                                             <input type="date" class="form-control mb-2" id="goal-date" placeholder="Fecha objetivo" min="" onclick="this.showPicker && this.showPicker()">
                                          </div>
                                          <button class="btn btn-primary" id="save-goal">Guardar Meta</button>
                                          <button class="btn btn-secondary ms-2" id="toggle-completed-goals">
                                             <i class="fa fa-eye-slash me-1" id="toggle-goals-icon"></i> <span id="toggle-goals-text">Ver solo pendientes</span>
                                          </button>
                                          <!-- Antes del t√≠tulo 'Mis Metas' -->
                                          <div class="text-success fw-bold mb-1 mt-3" id="goals-progress-legend">¬°Lo est√°s haciendo bien! Este es tu avance:</div>
                                          <div class="progress my-3" style="height: 18px;">
                                             <div class="progress-bar bg-success" id="goals-progress-bar" role="progressbar" style="width: 0%; font-size: 14px;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                                          </div>
                                          <h5>Mis Metas:</h5>
                                          <!-- Historial de metas -->
                                          <ul class="list-group" id="goal-history">
                                             <!-- El historial se llenar√° din√°micamente -->
                                          </ul>
                                          <small class="text-muted d-block mt-2"><i class="fa fa-exclamation-triangle text-warning"></i> Pr√≥xima a vencer</small>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <!-- Formulario de Google -->
                        <div class="row">
                           <div class="col-md-12">
                              <div class="white_shd full margin_bottom_30">
                                 <div class="full graph_head">
                                    <div class="heading1 margin_0">
                                       <h2>Cuestionario de Estr√©s Acad√©mico</h2>
                                    </div>
                                 </div>
                                 <div class="full padding_infor_info">
                                    <div class="row">
                                       <div class="col-lg-12">
                                          <p class="mb-3">Te invitamos a diligenciar este breve cuestionario para conocer tu nivel de estr√©s frente a diferentes situaciones acad√©micas. Al finalizar, recibir√°s un informe personalizado con tu nivel de estr√©s y recomendaciones para gestionarlo.</p>
                                          <iframe src="https://forms.gle/YPv53RwKYFuzPVsw9" 
                                                  width="100%" 
                                                  height="600" 
                                                  frameborder="0" 
                                                  marginheight="0" 
                                                  marginwidth="0">
                                             Cargando...
                                          </iframe>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <!-- Nueva Secci√≥n de Recomendaciones para Ex√°menes -->
                        <div class="row">
                           <div class="col-md-12">
                              <div class="white_shd full margin_bottom_30">
                                 <div class="full graph_head">
                                    <div class="heading1 margin_0">
                                       <h2>Recomendaciones para Preparar tus Ex√°menes</h2>
                                    </div>
                                 </div>
                                 <div class="full padding_infor_info">
                                    <div class="row">
                                       <div class="col-lg-4 text-center">
                                          <img src="images/moods/invitation.jpeg" alt="Preparaci√≥n de ex√°menes" class="img-fluid mb-4" style="max-width: 200px; border-radius: 10px;">
                                       </div>
                                       <div class="col-lg-8">
                                          <h4 class="mb-4">Estrategias efectivas para el √©xito acad√©mico</h4>
                                          <div class="recommendations">
                                             <div class="recommendation-item mb-4">
                                                <h5><i class="fa fa-calendar me-2 text-primary"></i>Planificaci√≥n</h5>
                                                <ul class="list-unstyled ps-4">
                                                   <li>‚Ä¢ Crea un calendario de estudio 2-3 semanas antes del examen</li>
                                                   <li>‚Ä¢ Divide el material en secciones manejables</li>
                                                   <li>‚Ä¢ Establece objetivos diarios realistas</li>
                                                </ul>
                                             </div>
                                             <div class="recommendation-item mb-4">
                                                <h5><i class="fa fa-book me-2 text-success"></i>T√©cnicas de Estudio</h5>
                                                <ul class="list-unstyled ps-4">
                                                   <li>‚Ä¢ Utiliza mapas mentales y res√∫menes</li>
                                                   <li>‚Ä¢ Practica con ex√°menes anteriores</li>
                                                   <li>‚Ä¢ Aplica la t√©cnica Pomodoro: 25 minutos de estudio, 5 de descanso</li>
                                                </ul>
                                             </div>
                                             <div class="recommendation-item mb-4">
                                                <h5><i class="fa fa-heart me-2 text-danger"></i>Autocuidado</h5>
                                                <ul class="list-unstyled ps-4">
                                                   <li>‚Ä¢ Mant√©n un horario regular de sue√±o</li>
                                                   <li>‚Ä¢ Realiza pausas activas cada 2 horas</li>
                                                   <li>‚Ä¢ Practica ejercicios de respiraci√≥n antes del examen</li>
                                                </ul>
                                             </div>
                                             <div class="recommendation-item">
                                                <h5><i class="fa fa-users me-2 text-info"></i>Estudio en Grupo</h5>
                                                <ul class="list-unstyled ps-4">
                                                   <li>‚Ä¢ Organiza sesiones de estudio con compa√±eros</li>
                                                   <li>‚Ä¢ Explica los temas a otros para reforzar tu comprensi√≥n</li>
                                                   <li>‚Ä¢ Comparte y discute diferentes perspectivas del material</li>
                                                </ul>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <!-- Fin de la Nueva Secci√≥n -->
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <!-- Contenedor de Notificaciones -->
      <div id="notification-container" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>

      <!-- jQuery -->
      <script src="js/jquery.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.min.js"></script>
      <!-- wow animation -->
      <script src="js/animate.js"></script>
      <!-- select country -->
      <script src="js/bootstrap-select.js"></script>
      <!-- nice scrollbar -->
      <script src="js/perfect-scrollbar.min.js"></script>
      <script>
         var ps = new PerfectScrollbar('#sidebar');
      </script>
      <!-- custom js -->
      <script src="js/custom.js"></script>
      <script>
         // Funciones para manejar el localStorage
         function saveToLocalStorage(key, value, isCompleted = false) {
             let items = JSON.parse(localStorage.getItem(key) || '[]');
             
             // Si es una meta, agregar el estado de completado
             if (key === 'goals') {
                 items.unshift({
                     id: Date.now(), // Agregar un ID √∫nico
                     value: value,
                     date: new Date().toLocaleString(),
                     completed: false // Siempre se crea como no completada
                 });
                 // Mantener solo los √∫ltimos 15 items no completados
                 items = items.filter(item => !item.completed).slice(0, 15);
             } else if (key === 'completed_goals') {
                 items.unshift({
                     id: Date.now(), // Agregar un ID √∫nico
                     value: value,
                     date: new Date().toLocaleString(),
                     completed: true
                 });
                 // Mantener solo los √∫ltimos 15 items completados
                 items = items.slice(0, 15);
             } else {
                 items.unshift({
                     value: value,
                     date: new Date().toLocaleString()
                 });
                 // Mantener solo los √∫ltimos 5 items para estados de √°nimo
                 items = items.slice(0, 5);
             }
             
             localStorage.setItem(key, JSON.stringify(items));
             return items;
         }

         function getFromLocalStorage(key) {
             return JSON.parse(localStorage.getItem(key) || '[]');
         }

         function updateHistoryDisplay(key, containerId) {
             const items = getFromLocalStorage(key);
             const container = document.getElementById(containerId);
             
             if (key === 'goals') {
                 const completedItems = getFromLocalStorage('completed_goals');
                 const allItems = [...items, ...completedItems];
                 
                 container.innerHTML = allItems.map(item => `
                     <li class="list-group-item d-flex justify-content-between align-items-center ${item.completed ? 'text-muted' : ''}">
                         <div class="d-flex align-items-center">
                             <input type="checkbox" 
                                    class="form-check-input me-2" 
                                    ${item.completed ? 'checked' : ''} 
                                    onchange="toggleGoalCompletion(${item.id}, ${item.completed})">
                             <span style="${item.completed ? 'text-decoration: line-through;' : ''}">${item.value}</span>
                         </div>
                         <small class="text-muted">${item.date}</small>
                     </li>
                 `).join('');
             } else {
                 container.innerHTML = items.map(item => {
                     const date = item.timestamp ? new Date(item.timestamp.toDate()).toLocaleDateString() : 'Fecha no disponible';
                     return `
                         <div class="history-item d-flex justify-content-between align-items-center">
                             <span>${collection === 'moods' ? item.mood : item.goal}</span>
                             <small class="text-muted">${date}</small>
                         </div>
                     `;
                 }).join('');
             }
         }

         function toggleGoalCompletion(itemId, isCurrentlyCompleted) {
             const sourceKey = isCurrentlyCompleted ? 'completed_goals' : 'goals';
             const targetKey = isCurrentlyCompleted ? 'goals' : 'completed_goals';
             
             // Obtener las listas actuales
             const sourceItems = getFromLocalStorage(sourceKey);
             const targetItems = getFromLocalStorage(targetKey);
             
             // Encontrar el item a mover
             const itemIndex = sourceItems.findIndex(item => item.id === itemId);
             if (itemIndex === -1) return;
             
             const itemToMove = sourceItems[itemIndex];
             
             // Remover el item de la lista fuente
             sourceItems.splice(itemIndex, 1);
             localStorage.setItem(sourceKey, JSON.stringify(sourceItems));
             
             // Agregar el item a la lista destino con el estado opuesto
             itemToMove.completed = !isCurrentlyCompleted;
             targetItems.unshift(itemToMove);
             
             // Mantener el l√≠mite de 15 items
             const updatedTargetItems = targetItems.slice(0, 15);
             localStorage.setItem(targetKey, JSON.stringify(updatedTargetItems));
             
             // Actualizar la visualizaci√≥n
             updateHistoryDisplay('goals', 'goal-history');
         }

         function clearAllGoals() {
             if (confirm('¬øEst√°s seguro que deseas eliminar todas tus metas? Esta acci√≥n no se puede deshacer.')) {
                 localStorage.removeItem('goals');
                 localStorage.removeItem('completed_goals');
                 updateHistoryDisplay('goals', 'goal-history');
                 alert('Todas las metas han sido eliminadas.');
             }
         }

         // Inicializar historiales al cargar la p√°gina
         document.addEventListener('DOMContentLoaded', function() {
             updateHistoryDisplay('moods', 'mood-history');
             updateHistoryDisplay('goals', 'goal-history');
             
             // Establecer el m√≠nimo del datepicker a hoy
             const today = new Date();
             const yyyy = today.getFullYear();
             const mm = String(today.getMonth() + 1).padStart(2, '0');
             const dd = String(today.getDate()).padStart(2, '0');
             const minDate = `${yyyy}-${mm}-${dd}`;
             document.getElementById('goal-date').setAttribute('min', minDate);
         });

         // Script para manejar el guardado de la meta
         document.getElementById('save-goal').addEventListener('click', function() {
             const goal = document.getElementById('goal-input').value;
             const targetDate = document.getElementById('goal-date').value;
             saveGoal(goal, targetDate);
         });

         // Script para manejar el selector de estado de √°nimo
         document.getElementById('mood-selector').addEventListener('change', async function() {
            try {
               console.log('=== INICIO DEL EVENTO DE CAMBIO DE ESTADO DE √ÅNIMO ===');
               const mood = this.value;
               console.log('Valor seleccionado:', mood);
               
               if (mood) {
                  const moodText = this.options[this.selectedIndex].text;
                  console.log('Texto del estado de √°nimo:', moodText);
                  
                  const user = auth.currentUser;
                  if (!user) {
                     throw new Error('No hay usuario autenticado');
                  }
                  
                  console.log('Usuario autenticado:', user.email);
                  console.log('ID del usuario:', user.uid);

                  // Verificar si ya existe un registro para hoy
                  const today = new Date();
                  today.setHours(0, 0, 0, 0);
                  const tomorrow = new Date(today);
                  tomorrow.setDate(tomorrow.getDate() + 1);

                  const existingMood = await db.collection('moods')
                     .where('userId', '==', user.uid)
                     .orderBy('timestamp', 'desc')
                     .limit(1)
                     .get();

                  if (!existingMood.empty) {
                     const lastMood = existingMood.docs[0].data();
                     const lastMoodDate = lastMood.timestamp.toDate();
                     lastMoodDate.setHours(0, 0, 0, 0);
                     
                     if (lastMoodDate.getTime() === today.getTime()) {
                        showNotification(
                           'Ya registraste tu estado de √°nimo hoy',
                           'Puedes registrar un nuevo estado de √°nimo ma√±ana.',
                           'error'
                        );
                        this.value = '';
                        return;
                     }
                  }
                  
                  const moodData = {
                     mood: moodText,
                     userId: user.uid,
                     timestamp: firebase.firestore.FieldValue.serverTimestamp()
                  };
                  
                  console.log('Intentando guardar datos:', moodData);
                  
                  // Guardar en Firestore
                  const docRef = await db.collection('moods').add(moodData);
                  console.log('Documento guardado con ID:', docRef.id);
                  
                  // Verificar que se guard√≥ correctamente
                  const savedDoc = await docRef.get();
                  if (!savedDoc.exists) {
                     throw new Error('El documento no se guard√≥ correctamente');
                  }
                  
                  console.log('Documento guardado exitosamente:', savedDoc.data());
                  
                  // Resetear el selector
                  this.value = '';
                  
                  // Actualizar la visualizaci√≥n
                  await updateHistoryDisplay('moods', 'mood-history');
                  
                  // Actualizar las recomendaciones inmediatamente
                  await updateMoodFeedback();
                  
                  showNotification(
                     '¬°Estado de √°nimo guardado!',
                     'Gracias por compartir c√≥mo te sientes. Recuerda que estamos aqu√≠ para ayudarte.'
                  );
               }
               console.log('=== FIN DEL EVENTO DE CAMBIO DE ESTADO DE √ÅNIMO ===');
            } catch (error) {
               console.error('Error en el evento de cambio de estado de √°nimo:', error);
               showNotification(
                  'Error',
                  'No se pudo guardar el estado de √°nimo: ' + error.message,
                  'error'
               );
            }
         });
      </script>
      <!-- Firebase SDK -->
      <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
      <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

      <script>
         // Configuraci√≥n de Firebase
         const firebaseConfig = {
            apiKey: "AIzaSyD68fPBicLjW3kD82fpWh4FX7KWQM1-IUo",
            authDomain: "app-andina-stress.firebaseapp.com",
            projectId: "app-andina-stress",
            storageBucket: "app-andina-stress.firebasestorage.app",
            appId: "1:875424308312:web:315af68422cc007f95fe2d"
         };

         // Inicializar Firebase
         firebase.initializeApp(firebaseConfig);

         // Referencias a los servicios
         const auth = firebase.auth();
         const db = firebase.firestore();

         // Funci√≥n para iniciar sesi√≥n con Google
         window.loginWithGoogle = function() {
            const provider = new firebase.auth.GoogleAuthProvider();
            const authMessage = document.getElementById('auth-message');
            
            auth.signInWithPopup(provider)
               .then((result) => {
                  const user = result.user;
                  authMessage.className = 'success-message';
                  authMessage.textContent = '¬°Inicio de sesi√≥n exitoso!';
                  console.log('Usuario de Google:', user);
                  
                  // Asegurarnos de que el usuario est√© completamente autenticado
                  return auth.currentUser.getIdToken(true);
               })
               .then(() => {
                  // Cargar el historial despu√©s de asegurar la autenticaci√≥n
                  updateHistoryDisplay('moods', 'mood-history').catch(error => {
                     console.error('Error al cargar estados de √°nimo:', error);
                  });
                  updateHistoryDisplay('goals', 'goal-history').catch(error => {
                     console.error('Error al cargar metas:', error);
                  });
               })
               .catch((error) => {
                  authMessage.className = 'error-message';
                  if (error.code === 'auth/popup-closed-by-user') {
                     authMessage.textContent = 'El inicio de sesi√≥n fue cancelado';
                  } else if (error.code === 'auth/unauthorized-domain') {
                     authMessage.textContent = 'Este dominio no est√° autorizado para iniciar sesi√≥n';
                  } else {
                     authMessage.textContent = error.message;
                  }
                  console.error('Error en la autenticaci√≥n:', error);
               });
         }

         // Funci√≥n para cerrar sesi√≥n
         window.logout = function() {
            auth.signOut()
               .then(() => {
                  console.log('Sesi√≥n cerrada exitosamente');
               })
               .catch((error) => {
                  console.error('Error al cerrar sesi√≥n:', error);
               });
         }

         // Funci√≥n para guardar datos en Firestore
         async function saveToFirestore(collection, data) {
            try {
               const user = auth.currentUser;
               if (!user) {
                  throw new Error('Usuario no autenticado');
               }

               console.log('=== INICIO DEL GUARDADO ===');
               console.log('Guardando datos en', collection, ':', data);
               console.log('Usuario actual:', user.uid);

               const docData = {
                  ...data,
                  userId: user.uid,
                  timestamp: firebase.firestore.FieldValue.serverTimestamp()
               };

               console.log('Datos a guardar:', docData);

               // Intentar guardar el documento
               const docRef = await db.collection(collection).add(docData);
               console.log('Documento guardado con ID:', docRef.id);

               // Verificar que el documento se guard√≥ correctamente
               const savedDoc = await docRef.get();
               if (!savedDoc.exists) {
                  throw new Error('El documento no se guard√≥ correctamente');
               }

               const savedData = savedDoc.data();
               console.log('Documento guardado:', savedData);
               console.log('=== FIN DEL GUARDADO ===');

               return docRef.id;
            } catch (error) {
               console.error('Error al guardar en Firestore:', error);
               throw error;
            }
         }

         // Funci√≥n para obtener datos de Firestore
         async function getFromFirestore(collection) {
            try {
               const user = auth.currentUser;
               if (!user) {
                  throw new Error('Usuario no autenticado');
               }

               console.log('=== INICIO DE LA CONSULTA ===');
               console.log('Consultando Firestore...');
               console.log('Colecci√≥n:', collection);
               console.log('Usuario ID:', user.uid);

               // Realizar la consulta
               const query = db.collection(collection)
                  .where('userId', '==', user.uid)
                  .orderBy('timestamp', 'desc');
               
               console.log('Ejecutando consulta...');
               const snapshot = await query.get();
               console.log('Snapshot vac√≠o?', snapshot.empty);
               console.log('N√∫mero de documentos:', snapshot.size);

               if (!snapshot.empty) {
                  snapshot.forEach(doc => {
                     console.log('Documento encontrado:', doc.id, doc.data());
                  });
               }

               const data = snapshot.docs.map(doc => {
                  const docData = doc.data();
                  return {
                     id: doc.id,
                     ...docData
                  };
               });

               console.log('Datos procesados:', data);
               console.log('=== FIN DE LA CONSULTA ===');
               return data;
            } catch (error) {
               console.error('Error al obtener de Firestore:', error);
               throw error;
            }
         }

         // Funci√≥n para guardar el estado de √°nimo
         async function saveMood(mood) {
            try {
               console.log('=== INICIO GUARDAR ESTADO DE √ÅNIMO ===');
               console.log('Intentando guardar estado de √°nimo:', mood);
               
               const user = auth.currentUser;
               if (!user) {
                  throw new Error('No hay usuario autenticado');
               }
               
               const moodData = {
                  mood: mood,
                  userId: user.uid,
                  timestamp: firebase.firestore.FieldValue.serverTimestamp()
               };
               
               console.log('Intentando guardar datos:', moodData);
               
               const docRef = await db.collection('moods').add(moodData);
               console.log('Documento guardado con ID:', docRef.id);
               
               const savedDoc = await docRef.get();
               if (!savedDoc.exists) {
                  throw new Error('El documento no se guard√≥ correctamente');
               }
               
               console.log('Documento guardado exitosamente:', savedDoc.data());
               
               await updateHistoryDisplay('moods', 'mood-history');
               console.log('Historial actualizado');
               
               showNotification(
                  '¬°Estado de √°nimo guardado!',
                  'Gracias por compartir c√≥mo te sientes. Recuerda que estamos aqu√≠ para ayudarte.'
               );
            } catch (error) {
               console.error('Error al guardar el estado de √°nimo:', error);
               showNotification(
                  'Error',
                  'No se pudo guardar el estado de √°nimo: ' + error.message,
                  'error'
               );
            }
         }

         // Funci√≥n para guardar una meta
         async function saveGoal(goal, targetDate) {
            try {
               // Validar campos
               if (!goal || !targetDate) {
                  showNotification(
                     'Campos incompletos',
                     'Por favor, ingresa la meta y la fecha objetivo.',
                     'error'
                  );
                  return;
               }
               // Validar que la fecha no sea anterior a hoy
               const today = new Date();
               today.setHours(0,0,0,0);
               const selectedDate = new Date(targetDate);
               selectedDate.setHours(0,0,0,0);
               if (selectedDate < today) {
                  showNotification(
                     'Fecha inv√°lida',
                     'La fecha objetivo no puede ser anterior a hoy.',
                     'error'
                  );
                  return;
               }
               console.log('Intentando guardar meta:', goal, 'Fecha objetivo:', targetDate);
               const docId = await saveToFirestore('goals', { goal, targetDate, completed: false });
               console.log('Meta guardada exitosamente con ID:', docId);
               await updateHistoryDisplay('goals', 'goal-history');
               showNotification(
                  '¬°Meta guardada!',
                  'Tu meta ha sido guardada exitosamente.'
               );
               // Limpiar los campos solo si se guard√≥ correctamente
               document.getElementById('goal-input').value = '';
               document.getElementById('goal-date').value = '';
            } catch (error) {
               console.error('Error al guardar la meta:', error);
               showNotification(
                  'Error',
                  'No se pudo guardar la meta: ' + error.message,
                  'error'
               );
            }
         }

         // Cargar el historial cuando el usuario inicie sesi√≥n
         auth.onAuthStateChanged((user) => {
            const authContainer = document.getElementById('auth-container');
            const appContent = document.getElementById('app-content');
            const userEmail = document.getElementById('user-email');
            const sidebarUsername = document.getElementById('sidebar-username');
            const sidebarUserPhoto = document.getElementById('sidebar-user-photo');

            if (user) {
               console.log('Usuario autenticado:', user.email);
               authContainer.style.display = 'none';
               appContent.style.display = 'block';
               if (userEmail) {
                  userEmail.textContent = user.email;
               }
               if (sidebarUsername) {
                  sidebarUsername.textContent = user.displayName || 'Estudiante';
               }
               if (sidebarUserPhoto) {
                  sidebarUserPhoto.src = user.photoURL || 'images/layout_img/user_img.jpg';
                  sidebarUserPhoto.alt = user.displayName || 'Foto de perfil';
               }
               updateHistoryDisplay('moods', 'mood-history').catch(error => {
                  console.error('Error al cargar estados de √°nimo:', error);
               });
               updateHistoryDisplay('goals', 'goal-history').catch(error => {
                  console.error('Error al cargar metas:', error);
               });
            } else {
               console.log('No hay usuario autenticado');
               authContainer.style.display = 'block';
               appContent.style.display = 'none';
               if (sidebarUsername) {
                  sidebarUsername.textContent = 'Estudiante';
               }
               if (sidebarUserPhoto) {
                  sidebarUserPhoto.src = 'images/layout_img/user_img.jpg';
                  sidebarUserPhoto.alt = 'Foto de perfil';
               }
            }
         });

         // Funci√≥n para actualizar el historial
         async function updateHistoryDisplay(collection, elementId) {
            try {
               const user = auth.currentUser;
               if (!user) {
                  console.log('No hay usuario autenticado, esperando...');
                  return;
               }
               console.log('Obteniendo datos para:', collection, 'usuario:', user.email);
               const data = await getFromFirestore(collection);
               console.log('Datos obtenidos:', data);
               
               const historyElement = document.getElementById(elementId);
               if (historyElement) {
                  if (collection === 'goals') {
                     // Barra de progreso
                     const progressBar = document.getElementById('goals-progress-bar');
                     if (progressBar) {
                        const total = data.length;
                        const completed = data.filter(item => item.completed).length;
                        const percent = total > 0 ? Math.round((completed / total) * 100) : 0;
                        progressBar.style.width = percent + '%';
                        progressBar.setAttribute('aria-valuenow', percent);
                        progressBar.textContent = percent + '% completado';
                     }
                     let filtered = data;
                     if (hideCompletedGoals) {
                        filtered = data.filter(item => !item.completed);
                     }
                     // Ordenar por fecha objetivo (m√°s pr√≥xima primero)
                     filtered = filtered.sort((a, b) => {
                        if (!a.targetDate) return 1;
                        if (!b.targetDate) return -1;
                        return new Date(a.targetDate) - new Date(b.targetDate);
                     });
                     const now = new Date();
                     historyElement.innerHTML = filtered.map(item => {
                        const date = item.targetDate ? new Date(item.targetDate) : null;
                        const dateStr = date ? date.toLocaleDateString() : 'Sin fecha';
                        const checked = item.completed ? 'checked' : '';
                        const style = item.completed ? 'text-decoration: line-through; color: #888;' : '';
                        let warning = '';
                        if (date && !item.completed) {
                           const diff = (date - now) / (1000 * 60 * 60 * 24);
                           if (diff >= 0 && diff < 7) {
                              warning = `<span class='text-warning ms-2'><i class='fa fa-exclamation-triangle'></i></span>`;
                           }
                        }
                        return `
                           <li class="list-group-item d-flex justify-content-between align-items-center">
                              <div class="d-flex align-items-center">
                                 <input type="checkbox" class="form-check-input goal-checkbox me-2" data-id="${item.id}" ${checked}>
                                 <span style="${style}">${item.goal}</span>
                                 ${warning}
                              </div>
                              <small class="text-muted">${dateStr}</small>
                           </li>
                        `;
                     }).join('');
                  } else {
                     historyElement.innerHTML = data.map(item => {
                        const date = item.timestamp ? new Date(item.timestamp.toDate()).toLocaleDateString() : 'Fecha no disponible';
                        return `
                           <div class="history-item d-flex justify-content-between align-items-center">
                              <span>${collection === 'moods' ? item.mood : item.goal}</span>
                              <small class="text-muted">${date}</small>
                           </div>
                        `;
                     }).join('');
                  }
               }
            } catch (error) {
               console.error('Error al actualizar el historial:', error);
               throw error;
            }
         }

         // Funci√≥n para eliminar un elemento
         async function deleteItem(collection, docId) {
            try {
               await deleteFromFirestore(collection, docId);
               updateHistoryDisplay(collection, `${collection}-history`);
            } catch (error) {
               console.error('Error al eliminar el elemento:', error);
               alert('Error al eliminar el elemento');
            }
         }

         // Funci√≥n para limpiar todas las metas
         async function clearAllGoals() {
            try {
               const goals = await getFromFirestore('goals');
               for (const goal of goals) {
                  await deleteFromFirestore('goals', goal.id);
               }
               updateHistoryDisplay('goals', 'goal-history');
               alert('Todas las metas han sido eliminadas');
            } catch (error) {
               console.error('Error al limpiar las metas:', error);
               alert('Error al limpiar las metas');
            }
         }
      </script>

      <!-- Modal para Eliminar Contrase√±a -->
      <div class="modal fade" id="resetPasswordModal" tabindex="-1" aria-labelledby="resetPasswordModalLabel" aria-hidden="true">
         <div class="modal-dialog">
            <div class="modal-content">
               <div class="modal-header">
                  <h5 class="modal-title" id="resetPasswordModalLabel">Eliminar Contrase√±a</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
               </div>
               <div class="modal-body">
                  <form id="resetPasswordForm">
                     <div class="mb-3">
                        <label for="currentPassword" class="form-label">Contrase√±a Actual</label>
                        <input type="password" class="form-control" id="currentPassword" required>
                     </div>
                     <div class="mb-3">
                        <label for="newPassword" class="form-label">Nueva Contrase√±a</label>
                        <input type="password" class="form-control" id="newPassword" required>
                     </div>
                     <div class="mb-3">
                        <label for="confirmNewPassword" class="form-label">Confirmar Nueva Contrase√±a</label>
                        <input type="password" class="form-control" id="confirmNewPassword" required>
                     </div>
                  </form>
                  <div id="resetPasswordMessage" class="alert" style="display: none;"></div>
               </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                  <button type="button" class="btn btn-primary" onclick="resetPassword()">Cambiar Contrase√±a</button>
               </div>
            </div>
         </div>
      </div>

      <!-- Bootstrap JS -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

      <script>
         // Funci√≥n para mostrar el modal de cambio de contrase√±a
         window.showResetPasswordForm = function() {
            const resetPasswordModal = new bootstrap.Modal(document.getElementById('resetPasswordModal'));
            resetPasswordModal.show();
         }

         // Funci√≥n para cambiar la contrase√±a
         window.resetPassword = function() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            const messageDiv = document.getElementById('resetPasswordMessage');

            // Validar que las contrase√±as coincidan
            if (newPassword !== confirmNewPassword) {
               messageDiv.className = 'alert alert-danger';
               messageDiv.textContent = 'Las nuevas contrase√±as no coinciden';
               messageDiv.style.display = 'block';
               return;
            }

            const user = auth.currentUser;
            if (!user) {
               messageDiv.className = 'alert alert-danger';
               messageDiv.textContent = 'No hay usuario autenticado';
               messageDiv.style.display = 'block';
               return;
            }

            // Reautenticar al usuario antes de cambiar la contrase√±a
            const credential = firebase.auth.EmailAuthProvider.credential(
               user.email,
               currentPassword
            );

            user.reauthenticateWithCredential(credential)
               .then(() => {
                  // Cambiar la contrase√±a
                  return user.updatePassword(newPassword);
               })
               .then(() => {
                  messageDiv.className = 'alert alert-success';
                  messageDiv.textContent = 'Contrase√±a actualizada exitosamente';
                  messageDiv.style.display = 'block';
                  
                  // Limpiar el formulario
                  document.getElementById('resetPasswordForm').reset();
                  
                  // Cerrar el modal despu√©s de 2 segundos
                  setTimeout(() => {
                     const modal = bootstrap.Modal.getInstance(document.getElementById('resetPasswordModal'));
                     modal.hide();
                  }, 2000);
               })
               .catch((error) => {
                  messageDiv.className = 'alert alert-danger';
                  messageDiv.textContent = error.message;
                  messageDiv.style.display = 'block';
               });
         }
      </script>

      <script>
         // Funci√≥n para mostrar notificaciones
         function showNotification(title, message, type = 'success') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            
            notification.innerHTML = `
               <i class="fa ${icon}"></i>
               <div class="notification-content">
                  <div class="notification-title">${title}</div>
                  <div class="notification-message">${message}</div>
               </div>
            `;
            
            container.appendChild(notification);
            
            // Eliminar la notificaci√≥n despu√©s de 3 segundos
            setTimeout(() => {
               notification.style.animation = 'fadeOut 0.3s ease-out';
               setTimeout(() => {
                  container.removeChild(notification);
               }, 300);
            }, 3000);
         }
      </script>

      <script>
         // Configuraci√≥n de los estados de √°nimo
         const moodConfig = {
            frustrado: {
               frase: "El estr√©s acad√©mico puede ser abrumador. Recuerda que cada desaf√≠o es una oportunidad para crecer y aprender nuevas estrategias de manejo.",
               sugerencias: [
                  "T√©cnica de respiraci√≥n 4-4-4: inhala 4s, ret√©n 4s, exhala 4s",
                  "Organiza tus tareas por prioridad y tiempo estimado",
                  "Toma descansos activos de 5 minutos entre sesiones de estudio"
               ],
               imagen: "images/moods/frustrado.jpeg",
               color: "#FFA07A"
            },
            feliz: {
               frase: "¬°Excelente! Mant√©n ese equilibrio entre tus estudios y bienestar. Comparte tus estrategias exitosas con otros estudiantes.",
               sugerencias: [
                  "Registra en tu diario qu√© estrategias te funcionaron hoy",
                  "Planifica tu pr√≥xima sesi√≥n de estudio manteniendo este estado positivo",
                  "Practica mindfulness para mantener este equilibrio"
               ],
               imagen: "images/moods/feliz.jpeg",
               color: "#7fb536"
            },
            triste: {
               frase: "El estr√©s acad√©mico puede afectar nuestro estado de √°nimo. Recuerda que es temporal y que tienes herramientas para manejarlo.",
               sugerencias: [
                  "Escribe en tu diario acad√©mico qu√© te est√° afectando",
                  "Escucha m√∫sica relajante mientras organizas tus materiales",
                  "Practica la t√©cnica de los 5 sentidos para volver al presente"
               ],
               imagen: "images/moods/triste.jpeg",
               color: "#3498DB"
            },
            ansioso: {
               frase: "La ansiedad ante los ex√°menes y trabajos es com√∫n. Vamos a trabajar en t√©cnicas espec√≠ficas para manejarla.",
               sugerencias: [
                  "T√©cnica 5-4-3-2-1: identifica 5 cosas que ves, 4 que puedes tocar, 3 que escuchas, 2 que hueles, 1 que saboreas",
                  "Divide tus tareas en pasos m√°s peque√±os y manejables",
                  "Practica la respiraci√≥n diafragm√°tica durante 5 minutos"
               ],
               imagen: "images/moods/ansioso.jpeg",
               color: "#F59C00"
            }
         };

         // Funci√≥n para actualizar la secci√≥n de estado de √°nimo
         async function updateMoodFeedback() {
            try {
               const user = auth.currentUser;
               if (!user) return;

               const data = await getFromFirestore('moods');
               const moodFeedback = document.getElementById('mood-feedback');
               
               if (!data || data.length === 0) {
                  moodFeedback.innerHTML = `
                     <div class="text-center p-4">
                        <img src="images/moods/invitation.jpeg" alt="Invitation" class="img-fluid mb-3" style="max-width: 150px;">
                        <p class="lead">¬øC√≥mo te sientes hoy?</p>
                        <p>Comparte tu estado de √°nimo para recibir t√©cnicas personalizadas de manejo del estr√©s acad√©mico y estrategias de estudio efectivas.</p>
                     </div>
                  `;
                  return;
               }

               const lastMood = data[0];
               // Obtener el valor del estado de √°nimo directamente del texto
               const moodText = lastMood.mood.split(' ')[1].toLowerCase().replace('(a)', '');
               console.log('Estado de √°nimo detectado:', moodText);
               
               const config = moodConfig[moodText];
               console.log('Configuraci√≥n encontrada:', config);

               if (!config) {
                  console.error('Configuraci√≥n no encontrada para el estado de √°nimo:', moodText);
                  moodFeedback.innerHTML = `
                     <div class="alert alert-warning">
                        <p>Lo sentimos, no pudimos encontrar recomendaciones para tu estado de √°nimo actual.</p>
                     </div>
                  `;
                  return;
               }

               moodFeedback.innerHTML = `
                  <div class="p-4" style="background-color: ${config.color}15; border-radius: 10px;">
                     <img src="${config.imagen}" alt="${moodText}" class="img-fluid mb-3" style="max-width: 150px;">
                     <p class="lead mb-4 text-start">${config.frase}</p>
                     <div class="suggestions text-start">
                        <h6 class="mb-3">Sugerencias para ti:</h6>
                        <ul class="list-unstyled">
                           ${config.sugerencias.map(sug => `
                              <li class="mb-2">
                                 <i class="fa fa-check-circle me-2"></i>${sug}
                              </li>
                           `).join('')}
                        </ul>
                     </div>
                  </div>
               `;
            } catch (error) {
               console.error('Error al actualizar el feedback del estado de √°nimo:', error);
               const moodFeedback = document.getElementById('mood-feedback');
               moodFeedback.innerHTML = `
                  <div class="alert alert-danger">
                     <p>Lo sentimos, hubo un error al cargar tu espacio de bienestar.</p>
                  </div>
               `;
            }
         }

         // Actualizar el feedback cuando cambie el estado de √°nimo
         document.getElementById('mood-selector').addEventListener('change', async function() {
            // ... c√≥digo existente ...
            await updateMoodFeedback();
         });

         // Actualizar el feedback cuando el usuario inicie sesi√≥n
         auth.onAuthStateChanged((user) => {
            if (user) {
               updateMoodFeedback();
            }
         });
      </script>

      <!-- Checklist para marcar metas como finalizadas -->
      <script>
         document.getElementById('goal-history').addEventListener('change', async function(e) {
            if (e.target.classList.contains('goal-checkbox')) {
               const docId = e.target.dataset.id;
               const completed = e.target.checked;
               try {
                  await db.collection('goals').doc(docId).update({ completed });
                  await updateHistoryDisplay('goals', 'goal-history');
               } catch (error) {
                  showNotification('Error', 'No se pudo actualizar el estado de la meta.', 'error');
               }
            }
         });
      </script>

      <script>
         let hideCompletedGoals = false;
         document.getElementById('toggle-completed-goals').addEventListener('click', function() {
            hideCompletedGoals = !hideCompletedGoals;
            updateHistoryDisplay('goals', 'goal-history');
            const icon = document.getElementById('toggle-goals-icon');
            const text = document.getElementById('toggle-goals-text');
            if (hideCompletedGoals) {
               icon.classList.remove('fa-eye-slash');
               icon.classList.add('fa-eye');
               text.textContent = 'Ver todas';
            } else {
               icon.classList.remove('fa-eye');
               icon.classList.add('fa-eye-slash');
               text.textContent = 'Ver solo pendientes';
            }
         });
      </script>
   </body>
</html> 